<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>test</title>
    </head>
    <body>
        
        <script>
            //总结：如果构造函数有return值，那么构造函数里的变量不能用this.来定义，用var来定义的话可以在构造函数的函数中取到，也可以在return的函数中取到。但注意直接饮用，不要用this.
            //构造函数里的函数，可以在return中取到，但是不能由实例直接取
            //我的理解是，构造函数中的return的意义，类似于把构造函数里其他东西隐藏起来，变成私有的，只有从return中的变量和函数是公有的，可以调用私有的变量和函数，可以由实例直接调用
            var test=function(){
                this.t0=0;//这种写法怎么都取不到，如果直接用t0会报错，如果用this.t0不报错但取不到
                //对任何构造函数（不管有没有return），var定义的属性都是私有的
                var t1=1;//这种直接取取不到,可以从函数中用t1取到,用this.t1也取不到
                function t2(){
                    return 2;
                    //return t1;//取的到
                    //return this.t1;//取不到
                    //return t0;//报错undefined
                    //return this.t0;//取不到
                }
                return{
                    t3:t1,//这个值是取不到的，会报错t是undefined//这里如果用this.t1也取不到
                    t4:t2(),
                    t5: function(){
                        return 3;
                    },
                    t6: function(){
                        return t1;//取的到
                        //return this.t1;//取不到
                    },
                    t7: function(){
                        return t2();//取的到
                    },
                    t8: function(){
                        //return t0;//报错undefined
                        return this.t0;//不报错，取不到
                    },
                }
            }
            // var test0=new test();
            // console.log(test0.t0);//这个值是取不到，会返回undefined
            // console.log(test0.t1);//这个值是取不到，会返回undefined
            // //console.log(test0.t2);//这样是undefined
            // //console.log(test0.t2());//这里居然报错说不是function
            // //console.log(test0().t3);//这个写法是错的，test0是对象不是函数
            // console.log(test0.t3);//取的到
            // console.log(test0.t4);
            // console.log(test0.t5());
            // console.log(test0.t6());//取的到
            // console.log(test0.t7());//取的到
            // console.log(test0.t8());//取不到



            var pubsub = {};   // 定义发布者

            (function (q) {

                var list = [],  //回调函数存放的数组，也就是记录有多少人订阅了我们东西
                    subUid = -1;

                // 发布消息,遍历订阅者
                q.publish = function (type, content) {
                    // type 为文章类型，content为文章内容
                    
                    // 如果没有人订阅，直接返回
                    if (!list[type]) {

                        return false;
                    }

                    var subscribers = list[type];
                    len = subscribers ? subscribers.length : 0;

                    while (len--) {
                        // 将内容注入到订阅者那里
                        subscribers[len].func(type, content);
                    }
                    console.log(list);
                    return true;

                };
                //订阅方法，由订阅者来执行
                q.subscribe = function (type, func) {
                    // 如果之前没有订阅过
                    if (!list[type]) {
                        list[type] = [];
                    }

                    // token相当于订阅者的id，这样的话如果退订，我们就可以针对它来知道是谁退订了。
                    var token = (++subUid).toString();
                    // 每订阅一个，就把它存入到我们的数组中去
                    list[type].push({
                        token: token,
                        func: func
                    });
                    return token;
                };
                //退订方法
                q.unsubscribe = function (token) {
                    for (var m in list) {
                        if (list[m]) {
                            for (var i = 0, j = list[m].length; i < j; i++) {
                                if (list[m][i].token === token) {
                                    list[m].splice(i, 1);
                                    return token;
                                }
                            }
                        }
                    }
                    return false;
                };

            })(pubsub);

            //将订阅赋值给一个变量，以便退订
            var girlA = pubsub.subscribe('js类的文章', function (type, content) {
                console.log('girlA订阅的'+type + ": 内容内容为：" + content);
            });

            var girlB = pubsub.subscribe('js类的文章', function (type, content) {
                console.log('girlB订阅的'+type + ": 内容内容为：" + content);
            });
            var girlC = pubsub.subscribe('js类的文章', function (type, content) {
                console.log('girlC订阅的'+type + ": 内容内容为：" + content);
            });
            var girlA = pubsub.subscribe('hhhhhhh类的文章', function (type, content) {
                console.log('girlA订阅的'+type + ": 内容内容为：" + content);
            });

            //发布通知
            pubsub.publish('js类的文章', '关于js的内容'); 
            // 输出：
            // girlC订阅的js类的文章: 内容内容为：关于js的内容
            // girlB订阅的js类的文章: 内容内容为：关于js的内容
            // girlA订阅的js类的文章: 内容内容为：关于js的内容


            //girlA退订了关于hhhhhhh类的文章 
            pubsub.unsubscribe(girlA);
            pubsub.unsubscribe(girlB);

            //再发布一次，验证一下是否还能够输出信息
            pubsub.publish('js类的文章', "关于js的第二篇文章");
            // 输出：
            // girlC订阅的js类的文章: 内容内容为：关于js的第二篇文章
            // girlA订阅的js类的文章: 内容内容为：关于js的第二篇文章

            var test =function(){
                console.log("testttttttttttttttttttttttttt");
            }

            var girlD = pubsub.subscribe('hhhhhhh类的文章', test);
            var girlE = pubsub.subscribe('hhhhhhh类的文章', function (type, content) {
                console.log('girlE订阅的'+type + ": 内容内容为：" + content);
            });
            var girlF = pubsub.subscribe('hhhhhhh类的文章', function (type, content) {
                console.log('girlF订阅的'+type + ": 内容内容为：" + content);
            });

            //发布通知
            pubsub.publish('hhhhhhh类的文章', '关于hhhhhhhh的内容');
            pubsub.publish('js类的文章', '关于js的第3篇文章');
        </script>
    </body>
</html>
